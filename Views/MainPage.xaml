<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="_SPS.Views.MainPage"
             xmlns:viewmodels="clr-namespace:_SPS.ViewModels"
             xmlns:models="clr-namespace:_SPS.Models"
             Title="SPS ë³´í˜¸ì†Œ">

    <ContentPage.BindingContext>
        <viewmodels:MainViewModel />
    </ContentPage.BindingContext>

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="ë‚´ê°€ ì“´ ê¸€" Command="{Binding NavigateToMyUploadsCommand}" Order="Secondary"/>
        <ToolbarItem Text="ë¡œê·¸ì•„ì›ƒ" Command="{Binding LogoutCommand}" Order="Secondary"/>
    </ContentPage.ToolbarItems>

    <Grid>
        <Grid RowDefinitions="Auto, *">

            <Frame Grid.Row="0" BackgroundColor="White" Padding="15" Margin="10,10,10,5" CornerRadius="15" HasShadow="True">
                <VerticalStackLayout Spacing="10">
                    <Label Text="{Binding UserEmail, StringFormat='ðŸ‘¤ ë¡œê·¸ì¸: {0}'}" TextColor="#555" FontSize="12" HorizontalOptions="End"/>

                    <Grid ColumnDefinitions="*, *" ColumnSpacing="10">
                        <Entry Grid.Column="0" Placeholder="ê²¬ì¢…" Text="{Binding SearchSpecies}" HeightRequest="40"/>
                        <Entry Grid.Column="1" Placeholder="ì§€ì—­" Text="{Binding SearchLocation}" HeightRequest="40"/>
                    </Grid>

                    <Grid ColumnDefinitions="*, *" ColumnSpacing="10">
                        <Frame Grid.Column="0" Padding="10,0" BorderColor="#ddd" CornerRadius="5" BackgroundColor="#F9F9F9" HeightRequest="40">
                            <Grid ColumnDefinitions="Auto, *">
                                <Label Grid.Column="0" Text="ì„±ë³„" VerticalOptions="Center" FontAttributes="Bold" TextColor="#555" FontSize="13" Margin="0,0,5,0"/>
                                <Picker Grid.Column="1" SelectedItem="{Binding SearchGender}" TextColor="Black" FontSize="13" VerticalOptions="Center" HorizontalOptions="FillAndExpand">
                                    <Picker.ItemsSource>
                                        <x:Array Type="{x:Type x:String}">
                                            <x:String>ì „ì²´</x:String>
                                            <x:String>ìˆ˜ì»·</x:String>
                                            <x:String>ì•”ì»·</x:String>
                                        </x:Array>
                                    </Picker.ItemsSource>
                                </Picker>
                            </Grid>
                        </Frame>

                        <Frame Grid.Column="1" Padding="10,0" BorderColor="#ddd" CornerRadius="5" BackgroundColor="#F9F9F9" HeightRequest="40">
                            <Grid ColumnDefinitions="Auto, *">
                                <Label Grid.Column="0" Text="ìƒíƒœ" VerticalOptions="Center" FontAttributes="Bold" TextColor="#555" FontSize="13" Margin="0,0,5,0"/>
                                <Picker Grid.Column="1" SelectedItem="{Binding SearchStatus}" TextColor="Black" FontSize="13" VerticalOptions="Center" HorizontalOptions="FillAndExpand">
                                    <Picker.ItemsSource>
                                        <x:Array Type="{x:Type x:String}">
                                            <x:String>ì „ì²´</x:String>
                                            <x:String>ë³´í˜¸ì¤‘</x:String>
                                            <x:String>ì‹¤ì¢…</x:String>
                                            <x:String>ìž…ì–‘ì™„ë£Œ</x:String>
                                        </x:Array>
                                    </Picker.ItemsSource>
                                </Picker>
                            </Grid>
                        </Frame>
                    </Grid>

                    <Button Text="ðŸ” ì¡°ê±´ ê²€ìƒ‰" Command="{Binding SearchPetsCommand}" BackgroundColor="#2196F3" TextColor="White" HeightRequest="40" CornerRadius="8"/>
                    <Button Text="í•„í„° ì´ˆê¸°í™”" Command="{Binding ResetFilterCommand}" BackgroundColor="Transparent" TextColor="Gray" FontSize="12" HeightRequest="30" Margin="0,-5,0,0"/>
                </VerticalStackLayout>
            </Frame>

            <CollectionView Grid.Row="1" 
                            Margin="0,0,0,80" 
                            ItemsSource="{Binding Pets}" 
                            SelectionMode="None">

                <CollectionView.EmptyView>
                    <StackLayout VerticalOptions="Center" HorizontalOptions="Center">
                        <Label Text="ë“±ë¡ëœ ë™ë¬¼ì´ ì—†ê±°ë‚˜ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤." TextColor="Gray"/>
                    </StackLayout>
                </CollectionView.EmptyView>

                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical" Span="2" HorizontalItemSpacing="10" VerticalItemSpacing="10"/>
                </CollectionView.ItemsLayout>

                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:PetModel">
                        <Frame Padding="0" CornerRadius="15" IsClippedToBounds="True" HasShadow="True" Margin="5" BackgroundColor="White">
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:MainViewModel}}, Path=GoToDetailCommand}" CommandParameter="{Binding .}"/>
                            </Frame.GestureRecognizers>

                            <Grid RowDefinitions="140, Auto">
                                <Grid Grid.Row="0">
                                    <Image Source="{Binding ImageUrl1}" Aspect="AspectFill" BackgroundColor="#f0f0f0"/>

                                    <Frame HorizontalOptions="Start" VerticalOptions="Start" Margin="5" Padding="6,3" CornerRadius="5" BackgroundColor="#D32F2F" BorderColor="Transparent">
                                        <Label Text="{Binding Status}" TextColor="White" FontSize="10" FontAttributes="Bold"/>
                                    </Frame>
                                </Grid>

                                <VerticalStackLayout Grid.Row="1" Padding="12">
                                    <Grid ColumnDefinitions="*, Auto">
                                        <Label Grid.Column="0" Text="{Binding Name}" FontAttributes="Bold" FontSize="16" TextColor="#333"/>
                                        <Label Grid.Column="1" Text="{Binding Gender}" TextColor="#2196F3" FontSize="11" FontAttributes="Bold"/>
                                    </Grid>

                                    <Label Text="{Binding Species}" TextColor="#666" FontSize="13" Margin="0,2,0,0"/>
                                    <Label Text="{Binding Location}" TextColor="#999" FontSize="11" LineBreakMode="TailTruncation" Margin="0,5,0,0"/>
                                </VerticalStackLayout>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>

            </CollectionView>

            <ActivityIndicator Grid.Row="1" IsRunning="{Binding IsBusy}" IsVisible="{Binding IsBusy}" 
                               Color="#2196F3" VerticalOptions="Center" HorizontalOptions="Center"/>
        </Grid>

        <Button Text="+" 
                Command="{Binding NavigateToAddPetCommand}"
                BackgroundColor="#4CAF50" 
                TextColor="White"
                FontSize="30"
                CornerRadius="30"
                WidthRequest="60"
                HeightRequest="60"
                HorizontalOptions="End"
                VerticalOptions="End"
                Margin="20"/>
    </Grid>
</ContentPage>